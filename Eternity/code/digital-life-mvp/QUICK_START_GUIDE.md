# 🚀 知识图谱系统 - 快速开始

## 第一步：执行数据库迁移

1. 打开 Supabase Dashboard
2. 进入 SQL Editor
3. 执行以下文件中的SQL：
   ```
   supabase/migrations/20260115_knowledge_graph.sql
   ```

这将创建以下表：
- ✅ `people` - 人物表
- ✅ `places` - 地点表
- ✅ `time_refs` - 时间引用表
- ✅ `events` - 事件表
- ✅ `memories` - 回忆表
- ✅ `event_people` - 事件-人物关联表
- ✅ `event_places` - 事件-地点关联表

## 第二步：启动开发服务器

```bash
cd /Users/liuxuyang/Desktop/Eternity/code/digital-life-mvp
npm run dev
```

## 第三步：访问新功能

打开浏览器访问以下页面：

### 1. AI 抽取页面
```
http://localhost:3000/extract
```
**用途**：粘贴对话记录，让AI自动提取人物、地点、时间、事件

**示例文本**：
```
我小时候住在牡丹江，那时候父亲在第一小学当老师。记得有一年冬天，
爸爸带我去公园看雪雕，母亲给我们准备了热水瓶。那天特别冷，但是
我们玩得很开心。后来我们搬到了哈尔滨，父亲调到了新单位工作。
```

### 2. 人物页面
```
http://localhost:3000/family
```
**用途**：查看所有人物卡片，点击进入详情页

### 3. 时间轴页面
```
http://localhost:3000/timeline
```
**用途**：按时间顺序查看所有事件，支持筛选

### 4. 地图页面
```
http://localhost:3000/places
```
**用途**：按地理位置查看人生足迹

## 第四步：使用流程演示

### 场景1：首次使用 - AI抽取

1. 访问 `/extract` 页面
2. 在文本框中粘贴一段对话或回忆录
3. 点击 **"✨ 开始 AI 抽取"** 按钮
4. 等待3-5秒，AI会分析并返回结果
5. 查看抽取结果：
   - 👤 人物（含别名、关系、置信度）
   - 📍 地点（含层级、提及次数）
   - 📅 事件（含标题、摘要、关联信息）
6. 勾选要保存的项（默认已选置信度>70%的结果）
7. 点击 **"💾 保存到知识图谱"** 按钮
8. 保存成功后会跳转到人物页面

### 场景2：查看人物详情

1. 在 `/family` 页面点击任意人物卡片
2. 进入人物详情页，查看：
   - 基本信息（姓名、关系、简介）
   - 照片墙
   - 相关事件
   - 共同回忆
   - 相关地点
3. 点击 **"编辑资料"** 按钮可修改信息
4. 填写完整后点击 **"保存"**

### 场景3：浏览时间轴

1. 访问 `/timeline` 页面
2. 查看按时间排序的所有事件
3. 使用筛选器：
   - ✅ 勾选特定人物（如"父亲"）
   - ✅ 勾选特定地点（如"牡丹江"）
   - ✅ 勾选标签（如"童年"）
4. 点击事件卡片中的 **"查看原文证据"**
5. 展开查看AI抽取时保存的原文片段

### 场景4：探索地图

1. 访问 `/places` 页面
2. 浏览按层级分组的地点列表
3. 点击任意地点卡片
4. 右侧显示地点详情：
   - 描述和照片
   - 时间范围
   - 子地点列表
   - 相关事件
   - 相关人物
5. 点击子地点继续探索

## 常见问题

### Q1: AI抽取失败怎么办？
**A**: 检查以下几点：
1. 确保 `.env.local` 中配置了 `OPENAI_API_KEY`
2. 检查网络连接
3. 查看浏览器控制台错误信息
4. 文本长度不要超过5000字

### Q2: 保存到数据库失败？
**A**: 
1. 确认已执行数据库迁移
2. 检查 Supabase 配置是否正确
3. 确认 `localStorage` 中有 `currentProjectId`

### Q3: 没有数据显示？
**A**:
1. 首次使用需要先在 `/extract` 页面抽取数据
2. 或者手动在人物页面添加人物
3. 确认浏览器没有拦截localStorage

### Q4: 如何批量导入数据？
**A**:
1. 准备多段文本（每段500-2000字）
2. 逐段在 `/extract` 页面进行AI抽取
3. 未来版本将支持批量上传文件

### Q5: 地图为什么不显示？
**A**:
- 当前版本暂未集成真实地图API
- 显示的是地点列表视图
- 后续版本将集成 Mapbox 或 Google Maps

## 技巧和建议

### 📝 写好输入文本
- **长度**：每段500-2000字为佳（太短信息不足，太长AI可能遗漏）
- **结构**：包含"谁+何时+何地+做了什么"
- **具体**：避免泛泛而谈，多用具体人名、地名、时间

**好的示例**：
```
1985年夏天，父亲（老刘）带我和母亲去北戴河度假。我们住在海边的
一个小旅馆，每天早上都能听到海浪声。有一天，爸爸教我游泳，妈妈
在岸边给我们拍照。那是我第一次看到大海，至今难忘。
```

**不好的示例**：
```
小时候去过很多地方，和家人一起旅游。
```

### 🎯 人物信息完善
- 为高频人物上传头像
- 补充一句话简介
- 记录别称（如：父亲=爸爸=老爸）
- 标注关系（父亲、母亲、朋友、老师等）

### 🗺️ 地点层级规划
- **国家级**：中国、美国
- **城市级**：牡丹江、哈尔滨、北京
- **区县级**：朝阳区、浦东新区
- **具体点**：第一小学、中山公园、家属楼

### ⏰ 时间表达技巧
- **精确日期**：1985年7月15日
- **范围时间**：小学三年级（1990-1991）
- **模糊时间**：那年冬天、大学时期

### 📊 提高置信度
- 多次提及同一信息（AI会累积置信度）
- 使用具体表达（"父亲老刘" 比 "他" 置信度高）
- 前后文一致（避免矛盾信息）

## 下一步

完成基础数据录入后，可以：

1. **完善资料**：在人物详情页补充照片和简介
2. **确认事件**：在时间轴页面验证AI抽取的事件
3. **关联照片**：将照片与人物和事件关联
4. **生成PDF**：在导出页面生成印刷级传记书

## 数据流程图

```
对话/文本
    ↓
AI抽取 (/extract)
    ↓
用户审核确认
    ↓
保存到数据库
    ├─→ /family (人物视图)
    ├─→ /timeline (时间轴视图)
    └─→ /places (地图视图)
    ↓
编辑完善
    ↓
导出成书 (/export)
```

## 系统导航

顶部导航栏包含：
- 🏠 **首页** - 系统概览
- 👥 **人物** - People Hub
- 📅 **时间轴** - Timeline
- 🗺️ **地图** - Places Map
- 🤖 **AI抽取** - Entity Extraction
- 💭 **今日对话** - Daily Chat
- 📖 **大纲** - Biography Outline
- 📦 **导出** - Export to PDF

## 性能建议

- **浏览器**：推荐使用 Chrome/Edge（最新版）
- **网络**：稳定的互联网连接（AI抽取需要）
- **数据量**：单个项目建议不超过500个人物、1000个事件
- **照片**：单张不超过5MB，总量控制在500MB以内

---

**开始你的传记之旅吧！** 🚀

如有问题，请查看完整文档：`KNOWLEDGE_GRAPH_README.md`
