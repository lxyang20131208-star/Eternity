# 印刷级PDF导出功能

## 功能概述

本系统提供专业的书籍排版和印刷级PDF生成功能，满足印刷厂交付标准。

## ✨ 主要特性

### 1. 专业书籍排版

#### 页面与版心
- ✅ **成品尺寸**：支持 A5 (148×210mm)、A4 (210×297mm) 等标准尺寸
- ✅ **出血设置**：默认 3mm 出血，可配置
- ✅ **版心配置**：
  - 上边距 18mm、下边距 20mm
  - 内侧（装订侧）22mm、外侧 16mm
  - 内侧边距大于外侧，防止内容被装订遮挡

#### 正文排版
- ✅ **字号**：10.5pt (A5) / 11pt (A4)
- ✅ **行距**：1.6 倍
- ✅ **对齐方式**：两端对齐 (justify)
- ✅ **首行缩进**：2em
- ✅ **段落间距**：0（无大留白）
- ✅ **防止孤行寡行**：orphans: 2, widows: 2

#### 章节样式
- ✅ **章节起始页**：第X章（小号）+ 章标题（大号）+ 留白后进入正文
- ✅ **首字下沉**：可选的 drop cap（2-3行）
- ✅ **章首留白**：25-30mm 固定留白

#### 页眉页脚
- ✅ **页码位置**：外侧下方、居中、内侧下方可选
- ✅ **页眉内容**：书名或章节名可选
- ✅ **字号**：9-10pt

#### 目录
- ✅ **自动生成**：章节标题 + 页码
- ✅ **对齐方式**：点线连接（dotted leader）
- ✅ **页码对齐**：右对齐

### 2. 印刷厂标准

#### 基本要求
- ✅ **PDF页面尺寸**：成品尺寸 + 出血
- ⚠️  **裁切线/出血线**：可通过配置显示（默认关闭）
- ⚠️  **字体嵌入**：使用标准字体（需印刷厂支持字体替换）
- ✅ **图片分辨率**：300dpi 预检验证
- ⚠️  **颜色模式**：RGB（需印刷前转换为CMYK）
- ⚠️  **黑色文字**：RGB黑色（#000000）
- ✅ **资源嵌入**：所有内容嵌入PDF中

#### PDF标准
- ⚠️  **PDF/X-1a**：配置支持，但受 jsPDF 限制
- ⚠️  **PDF/X-4**：配置支持，但受 jsPDF 限制
- ✅ **单页PDF**：每页独立，无跨页大画布

## 📋 三种导出模式

### 1. A5 印刷版（推荐用于印刷）
- 尺寸：148×210mm + 3mm出血
- 适用场景：专业印刷厂、按需印刷（POD）
- 特点：含出血、首字下沉、页眉页脚完整

### 2. A4 印刷版
- 尺寸：210×297mm + 3mm出血
- 适用场景：标准A4纸印刷
- 特点：页面更大，适合阅读

### 3. A4 家用版（推荐用于家庭打印）
- 尺寸：210×297mm（无出血）
- 适用场景：家用打印机、办公打印
- 特点：无出血、简化版式、150dpi

## 🔍 印刷预检功能

点击"🔍 印刷预检"按钮可查看：

### 检查项目
- ✅ 页面尺寸和出血设置
- ✅ 版心边距配置（装订侧是否足够）
- ⚠️  图片DPI检查（目前无图片）
- ⚠️  字体嵌入状态
- ⚠️  颜色模式（RGB/CMYK）

### 报告内容
- 基本信息：页面尺寸、总页数、文件大小估算
- 错误提示：必须修复的问题（阻止导出）
- 警告提示：建议优化的项目（不阻止导出）

## ⚠️  当前限制（jsPDF库）

由于使用 jsPDF 生成PDF，以下功能受限：

### 1. 颜色模式
- **现状**：输出为 RGB 颜色空间
- **解决方案**：
  - 印刷前使用 Adobe Acrobat Pro 转换为 CMYK
  - 或使用印刷厂的色彩转换服务

### 2. PDF标准
- **现状**：生成标准PDF，非 PDF/X-1a 或 PDF/X-4
- **解决方案**：
  - 使用 Adobe Acrobat Pro 转换为 PDF/X-1a
  - 或使用 Ghostscript 命令行工具转换

### 3. 字体嵌入
- **现状**：使用浏览器标准中文字体，转为图片嵌入
- **优点**：所有文字以图片形式完整嵌入，无字体丢失风险
- **缺点**：文件较大，文字无法选择复制

### 4. 黑色文字
- **现状**：使用 RGB 黑色 (#000000)
- **印刷建议**：纯黑文字通常不会有问题，印刷厂会自动转为 K100

## 💡 使用建议

### 家庭打印
1. 选择"A4 家用版"
2. 直接打印，无需后期处理

### 专业印刷
1. 选择"A5 印刷版"或"A4 印刷版"
2. 导出PDF
3. 点击"印刷预检"查看报告
4. **重要**：将PDF提交给印刷厂前，咨询以下内容：
   - 是否接受 RGB 颜色空间（大多数印刷厂可自动转换）
   - 是否需要 PDF/X-1a 标准（如需要，使用 Acrobat 转换）
   - 出血尺寸是否为 3mm（标准值）
   - 是否需要裁切线（可在配置中开启）

### 色彩转换（如需CMYK）

使用 Adobe Acrobat Pro：
```
文件 → 打印制作 → 转换颜色
- 转换配置文件：Coated FOGRA39 (ISO 12647-2:2004)
- 转换所有页面的颜色
- 嵌入颜色配置文件
```

或使用 Ghostscript：
```bash
gs -dSAFER -dBATCH -dNOPAUSE -dNOCACHE \
   -sDEVICE=pdfwrite \
   -sColorConversionStrategy=CMYK \
   -dProcessColorModel=/DeviceCMYK \
   -sOutputFile=output_cmyk.pdf \
   input_rgb.pdf
```

## 📐 配置文件结构

所有排版规则保存在 `/lib/printConfig.ts` 中：

```typescript
export interface PrintConfig {
  pageSize: { width, height, bleed, trim }
  margins: { top, bottom, inner, outer }
  body: { fontSize, lineHeight, align, indent }
  chapter: { titleFontSize, dropCap, ... }
  header: { enabled, fontSize, content }
  footer: { enabled, pageNumberPosition }
  print: { dpi, colorMode, embedFonts, pdfStandard }
}
```

可根据需要修改 `PRINT_PRESETS` 中的预设值。

## 🎯 实现状态总结

| 功能 | 状态 | 备注 |
|------|------|------|
| A5/A4 尺寸 | ✅ | 完全实现 |
| 出血设置 | ✅ | 3mm 标准出血 |
| 版心配置 | ✅ | 内侧 > 外侧 |
| 两端对齐 | ✅ | text-align: justify |
| 首行缩进 | ✅ | 2em |
| 行距控制 | ✅ | 1.6 倍行距 |
| 章节样式 | ✅ | 标题 + 留白 |
| 首字下沉 | ✅ | CSS ::first-letter |
| 页眉页脚 | ✅ | 可配置位置 |
| 目录生成 | ✅ | 自动生成 |
| 裁切线 | ✅ | 可选开启 |
| 300dpi | ✅ | canvas scale 控制 |
| 字体嵌入 | ⚠️  | 转图片嵌入 |
| CMYK | ⚠️  | 需后期转换 |
| PDF/X-1a | ⚠️  | 需后期转换 |
| K100黑色 | ⚠️  | 需后期处理 |

## 📞 技术支持

如果印刷厂对PDF有特殊要求，可以：
1. 提供本说明文档给印刷厂
2. 咨询是否接受 RGB PDF（90%的印刷厂可自动转换）
3. 如需专业转换，可寻求设计公司帮助
